# Тестовое задание на курс Python

## Описание

Выполненное тестовое задание на курс Python **ШИФТ ЦФТ**.

**Задание:** 

Реализуйте REST-сервис просмотра текущей зарплаты и даты следующего
повышения. Из-за того, что такие данные очень важны и критичны, каждый
сотрудник может видеть только свою сумму. Для обеспечения безопасности, вам
потребуется реализовать метод где по логину и паролю сотрудника будет выдан
секретный токен, который действует в течение определенного времени. Запрос
данных о зарплате должен выдаваться только при предъявлении валидного токена.

**Технические требования:**

1. Код размещен и доступен в публичном репозитории **GitLab**;
2. Должна быть оформлена инструкция;
3. Сервис должен быть реализован на **FastAPI**.

**Необязательные технические требования:**

1. Использовать менеджер зависимостей **poetry**;
2. Написать тесты с использованием **pytest**;
3. Реализовать возможность собирать и запускать контейнер с сервисом в **Docker**.

## Реализация задания

Использованные технологии:

* Веб-фреймворк **FastAPI**;
* Контейнеризация **Docker**;
* СУБД **SQLite**;
* ASGI сервер **uvicorn**;
* Тесты **pytest**;
* Менеджер зависимостей **poetry**.

Были выполнены все основные и необязательные технические требования.

* Авторизация пользователя через **JWT** токен, который действует в течение определенного времени;
* Пользователь может просматривать информацию о себе;
* Пользователь не может просматривать информацию о других пользователях;
* Запрос данных о зарплате выдается только при предъявлении валидного токена.

## API сервиса

В **API** используются следующие пути:

* **/users/** - POST запрос с **JSON** телом для создания пользователя;

* **/users/{username}/** - GET запрос для получения данных пользователя, где **username** - имя пользователя;

* **/token/** - POST запрос для получения нового токена авторизации;

* **/docs/**, **/redoc/** - автоматическая документация по **API** (**SwaggerUI**, **ReDoc**).

## Как пользоваться приложением?

1. Запустив приложение, перейдите по адресу **localhost:8000/docs/**.
2. Создайте пользователя через POST запрос к ***/users/***.

![Создание пользователя](https://i.imgur.com/syT9Jpl.png)

3. Нажмите кнопку **Authorize**, введите данные только что созданного пользователя.

![Авторизация пользователя](https://i.imgur.com/EVq3718.png)

4. Выполните поиск по имени пользователя через GET запрос к ***/users/{username}/***.

![Поиск валидного пользователя](https://i.imgur.com/FBOy0lt.png)

5. Выполните поиск по другому имени пользователя.

![Поиск невалидного пользователя](https://i.imgur.com/WtlCuYU.png)

Вы получите ошибку **401**, потому что пользователь не может смотреть зарплату и дату повышения других пользователей.

## Установка

**Запуск из контейнера Docker:**

1. Склонируйте репозиторий:<br>
    `$ git clone https://gitlab.com/test-tasks9135311/shift_project.git`

2. Соберите и запустите контейнер:<br>
    `$ docker-compose up --build`

**Для запуска приложения напрямую:**

Выполните следующие команды:

1. Склонируйте репозиторий:<br>
    `$ git clone https://gitlab.com/test-tasks9135311/shift_project.git`

2. Активируйте виртуальное окружение:<br>
    `$ poetry shell`

3. Загрузите зависимости:<br>
    `$ poetry install`

4. Если необходимо, в файле **.env** подставьте свои значения.

5. Запустите сервер **uvicorn**:<br>

    `$ uvicorn src.main:app --reload`

Запущенное приложение доступно по адресу **localhost:8000**. Интерактивная документация **localhost:8000/docs/**.

## Тесты

**Для запуска из контейнера Docker:**

Для запуска сервиса с одновременным запуском тестов используйте команду:<br>

`$ docker-compose -f docker-compose.test.yml up --build`

После выполнения тестов контейнер закроется.

**Для запуска вручную:**

Для запуска тестов требуется фреймворк **pytest**, так что он должен быть установлен в вашем виртуальном окружении.

1. Активируйте виртуальное окружение:<br>
    `$ poetry shell`

2. Загрузите зависимости:<br>
    `$ poetry install`

3. Запустите тесты:<br>
    `$ pytest`

## Структура базы данных

В приложении используется СУБД **SQLite**. В ходе работы создается файл базы данных **shift.db** с одной таблицей **users** со следующими столбцами:

![Даталогическая модель базы данных](https://i.imgur.com/SMAkZqV.png)

При выполнении тестов создается временная база данных **test_db.db** с аналогичными столбцами.
## Переменные окружения

**SECRET_KEY** - секретный ключ для генерации токенов. Новый можно получить командой:<br>
`$ openssl rand -hex 32`<br>
 **ALGORITHM** - алгоритм шифрования пользовательских паролей.<br>
 **TOKEN_MINUTES** - время жизни токена. Указывается в минутах. По истечению времени токен не валиден.<br>
 **DB_NAME** - название базы данных.